@{
    Layout = "~/Views/Shared/ConLayout.cshtml";
}
<div id="maindiv" class="container">
    <ul class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="/CH/index">首頁</a>
        </li>
        <li class="breadcrumb-item">基本資料</li>
        <li class="breadcrumb-item active">
            <a href="#">檢視編輯</a>
        </li>
    </ul>
    <section id="title">
        <div class="title-set">
            <h4 class="title">檢視編輯</h4><p class="w100" style="color:red">*無法自行修改的欄位，請檢附相關證明文件，寫一封照會請公司修改</p>
        </div>
    </section>
    <section id="form">
        <div class="row justify-content-md-center">
            <div class="col-lg-7 col-md-9">
                <form id="" class="confirm" action="" method="POST" name="">
                    <div class="form-group au-form row">
                        <label for="txtCon_ChiName_Last" class="col-3 col-form-label">中文姓</label>
                        <div class="col-9">
                            <input type="text" id="txtCon_ChiName_Last" name="txtCon_ChiName_Last" readonly style="background-color:lightgray">
                        </div>
                    </div>
                    <div class="form-group au-form row">
                        <label for="txtCon_ChiName_First" class="col-3 col-form-label">中文名</label>
                        <div class="col-9">
                            <input type="text" id="txtCon_ChiName_First" name="txtCon_ChiName_First" readonly style="background-color:lightgray">
                        </div>
                    </div>
                    <div class="form-group au-form row">
                        <label for="txtCon_EngName_Last" class="col-3 col-form-label">英文姓</label>
                        <div class="col-9">
                            <input type="text" id="txtCon_EngName_Last" name="txtCon_EngName_Last" readonly style="background-color:lightgray">
                        </div>
                    </div>
                    <div class="form-group au-form row">
                        <label for="txtCon_EngName_First" class="col-3 col-form-label">英文名</label>
                        <div class="col-9">
                            <input type="text" id="txtCon_EngName_First" name="txtCon_EngName_First" readonly style="background-color:lightgray">
                        </div>
                    </div>
                    <div class="form-group au-form row">
                        <label for="sele_Gender" class="col-3 col-form-label">性別</label>
                        <div class="col-9 select-wrapper">
                            <span class="iconify" data-icon="fa-solid:caret-down" data-inline="false"></span>
                            <select name="sele_Gender" id="sele_Gender" class="br-cus" disabled style="background-color:lightgray">
                                <option value="0">請選擇</option>
                                <option value="M">男</option>
                                <option value="F">女</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group au-form row">
                        <label for="txtCon_ID_Num" class="col-3 col-form-label">身份ID</label>
                        <div class="col-9">
                            <input type="text" id="txtCon_ID_Num" name="txtCon_ID_Num" readonly style="background-color:lightgray">
                        </div>
                    </div>
                    <div class="form-group au-form row">
                        <label for="txtCon_Passport" class="col-3 col-form-label">護照號碼</label>
                        <div class="col-9">
                            <input type="text" id="txtCon_Passport" name="txtCon_Passport" readonly style="background-color:lightgray">
                        </div>
                    </div>
                    <div class="form-group au-form row">
                        <label for="txtCon_BirthDay" class="col-3 col-form-label">出生日期</label>
                        <div class="col-9">
                            <input type="text" id="txtCon_BirthDay" name="txtCon_BirthDay" required
                                   data-error="請填寫出生日期">
                            <div class="help-block with-errors"></div>
                        </div>
                    </div>
                    <div class="form-group au-form row">
                        <label for="sele_Census_Country" class="col-3 col-form-label">地區</label>
                        <div class="col-9 select-wrapper">
                            <span class="iconify" data-icon="fa-solid:caret-down" data-inline="false"></span>
                            <select name="sele_Census_Country" id="sele_Census_Country" class="br-cus" disabled style="background-color:lightgray" >
                                <option value="0" disabled selected>請選擇</option>
                                <option value="TW">台灣</option>
                                <option value="CHN">中國</option>
                                <option value="HK">香港</option>
                                <option value="MO">澳門</option>
                                <option value="JP">日本</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group au-form row">
                        <label for="txtCon_Phone_site" class="col-3 col-form-label">行動電話</label>
                        <div class="col-4 underline">
                            <input type="text" id="txtCon_Phone_site" name="txtCon_Phone_site" readonly style="background-color:lightgray">
                        </div>
                        <div class="col-5">
                            <input type="text" id="txtCon_Phone" name="txtCon_Phone"
                                   required data-error="請填寫行動電話" readonly style="background-color:lightgray">
                        </div>
                    </div>
                    <div class="form-group au-form row">
                        <label for="txtCon_Email" class="col-3 col-form-label">Email</label>
                        <div class="col-9">
                            <input type="email" id="txtCon_Email" name="txtCon_Email"
                                   required data-error="請填寫Email" readonly style="background-color:lightgray">
                        </div>
                    </div>
                    <hr>
                    <h6>居住地址</h6>
                    <div class="form-group au-form row">
                        <label for="sele_Live_Country" class="col-3 col-form-label">地區</label>
                        <div class="col-9 select-wrapper">
                            <span class="iconify" data-icon="fa-solid:caret-down" data-inline="false"></span>
                            <select name="sele_Live_Country" id="sele_Live_Country" class="br-cus" required>
                                <option value="0" selected disabled>請選擇居住國家</option>
                                <option value="TW">台灣</option>
                                <option value="CHN">中國</option>
                                <option value="HK">香港</option>
                                <option value="MO">澳門</option>
                                <option value="JP">日本</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group au-form row">
                        <label for="txtCon_Live_Province" class="col-3 col-form-label">居住省份</label>
                        <div class="col-9">
                            <input type="text" id="txtCon_Live_Province" name="txtCon_Live_Province" />
                        </div>
                    </div>
                    <div class="form-group au-form row">
                        <label for="txtCon_Live_City" class="col-3 col-form-label">居住城市</label>
                        <div class="col-9">
                            <input type="text" id="txtCon_Live_City" name="txtCon_Live_City" required
                                   data-error="請填寫居住城市">
                            <div class="help-block with-errors"></div>
                        </div>
                    </div>
                    <div class="form-group au-form row">
                        <label for="txtCon_Live_Addr" class="col-3 col-form-label">居住地址</label>
                        <div class="col-9">
                            <textarea rows="6" id="txtCon_Live_Addr" name="txtCon_Live_Addr" required
                                      data-error="請填寫居住地址"></textarea>
                            <div class="help-block with-errors mt-none"></div>
                        </div>
                    </div>
                    <div class="form-group au-form row">
                        <div class="col-3">
                            <label for="txtCon_Eng_Addr" class="col-form-label">英文居住地址</label><br />
                            <a href="https://www.post.gov.tw/post/internet/Postal/index.jsp?ID=207" class="hp-txt" target="_blank">地址翻譯連結</a>
                        </div>
                        <div class="col-9">
                            <textarea rows="6" id="txtCon_Eng_Addr" name="txtCon_Eng_Addr" required
                                      data-error="請填寫英文居住地址"></textarea>
                            <div class="help-block with-errors mt-none"></div>
                        </div>
                    </div>
                    <div class="form-group au-form row">
                        <label for="txtCon_PostalCode" class="col-3 col-form-label">郵政編號</label>
                        <div class="col-9">
                            <input type="text" id="txtCon_PostalCode" name="txtCon_PostalCode">
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <input type="button" class="btn btn-sm btn-primary" onclick="Credentials()" value="證件狀態">
                        <input type="button" class="btn btn-sm btn-primary" onclick="SubmitEdit()" value="確認修改">
                    </div>
                </form>
            </div>
        </div>
    </section>
    
</div>
<script>
    //權限設定
    var conRole = readCookie('conRole');
    var conAccount = readCookie('conAccount');

    //日期設定
    $('#txtCon_BirthDay').datepicker({
        format: "yyyy/mm/dd",
        autoclose: true,
        //startDate: "today",
        todayHighlight: true,
        language: 'zh-TW'
    });
    $("#sele_Census_Country").change(function () {
        var t = $("option:selected", this).val();
        switch (t) {
            case 'TW':
                $("#txtCon_Phone_site").val('886');
                break;
            case 'HK':
                $("#txtCon_Phone_site").val('852');
                break;
            case 'MO':
                $("#txtCon_Phone_site").val('853');
                break;
            case 'CHN':
                $("#txtCon_Phone_site").val('86');
                break;
            case 'JP':
                $("#txtCon_Phone_site").val('81');
                break;
        }
    });


    $(document).ready(function () {
        $('#maindiv').jqLoading();
        loadData();
        $('#maindiv').jqLoading("destroy");
    });

    function loadData() {
        //清空資料
        $('#txtCon_ChiName_Last').val(''); $('#txtCon_ChiName_First').val(''); $('#txtCon_EngName_Last').val(''); $('#txtCon_EngName_First').val('');
        $('#sele_Gender').val('0'); $('#txtCon_ID_Num').val(''); $('#txtCon_Passport').val(''); $('#txtCon_BirthDay').val(''); $('#sele_Census_Country').val('0');
        $('#txtCon_Phone_site').val(''); $('#txtCon_Phone').val(''); $('#txtCon_Email').val(''); $('#sele_Live_Country').val('0');
        $('#txtCon_Live_Province').val(''); $('#txtCon_Live_City').val(''); $('#txtCon_Live_Addr').val(''); $('#txtCon_Eng_Addr').val('');
        $('#txtCon_PostalCode').val('');

        //查詢詳細顧問資料
        var obj =
        {
            ConID: $.trim(conAccount)
        }
        $('#maindiv').jqLoading();
        $.getJSON("/ConInfo/GetConInfoByID", obj).done(function (data) {
            //填入資料
            $('#txtCon_ChiName_Last').val($.trim(data[0].Con_ChiNAME_Last)); $('#txtCon_ChiName_First').val($.trim(data[0].Con_ChiNAME_First));
            $('#txtCon_EngName_Last').val($.trim(data[0].Con_EngNAME_Last)); $('#txtCon_EngName_First').val($.trim(data[0].Con_EngNAME_First));
            $('#sele_Gender').val(data[0].Con_Gender); $('#txtCon_ID_Num').val($.trim(data[0].Con_ID_Num)); $('#txtCon_Passport').val($.trim(data[0].Con_Passport));
            $('#txtCon_BirthDay').datepicker("setDate", data[0].Con_BirthDay_new);
            $('#sele_Census_Country').val(data[0].Con_Census_Country); $('#txtCon_Phone_site').val($.trim(data[0].Con_Phone_site));
            $('#txtCon_Phone').val($.trim(data[0].Con_Phone)); $('#txtCon_Email').val($.trim(data[0].Con_Email)); $('#sele_Live_Country').val(data[0].Con_Live_Country);
            $('#txtCon_Live_Province').val($.trim(data[0].Con_Live_Province)); $('#txtCon_Live_City').val($.trim(data[0].Con_Live_City));
            $('#txtCon_Live_Addr').val($.trim(data[0].Con_Live_Address)); $('#txtCon_Eng_Addr').val($.trim(data[0].Con_Eng_Address)); $('#txtCon_PostalCode').val($.trim(data[0].Con_PostalCode));

            $('#maindiv').jqLoading("destroy");
        })
    }
    function SubmitEdit() {
        var obj = {};
        obj.Con_ID = conAccount
        obj.Con_ChiNAME_Last = $('#txtCon_ChiName_Last').val();
        obj.Con_ChiNAME_First = $('#txtCon_ChiName_First').val();
        obj.Con_EngNAME_Last = $('#txtCon_EngName_Last').val();
        obj.Con_EngNAME_First = $('#txtCon_EngName_First').val();
        obj.Con_Gender = $('#sele_Gender').val();
        obj.Con_ID_Num = $('#txtCon_ID_Num').val();
        obj.Con_Passport = $('#txtCon_Passport').val();
        obj.Con_BirthDay = $('#txtCon_BirthDay').val();
        obj.Con_Census_Country = $('#sele_Census_Country').val();
        obj.Con_Phone_site = $('#txtCon_Phone_site').val();
        obj.Con_Phone = $('#txtCon_Phone').val();
        obj.Con_Email = $('#txtCon_Email').val();
        obj.Con_Live_Country = $('#sele_Live_Country').val();
        obj.Con_Live_Province = $('#txtCon_Live_Province').val();
        obj.Con_Live_City = $('#txtCon_Live_City').val();
        obj.Con_Live_Address = $('#txtCon_Live_Addr').val();
        obj.Con_Eng_Address = $('#txtCon_Eng_Addr').val();
        obj.Con_PostalCode = $('#txtCon_PostalCode').val();
        obj.LoginACCOUNT = conAccount;
        $('#maindiv').jqLoading();
        var options = {};
        options.url = "/ConInfo/SaveConInfo";
        options.type = "POST";
        options.data = JSON.stringify(obj);
        options.contentType = "application/json";
        options.dataType = "html";
        options.success = function (data) {
            if (data == 1) {
                //alert('修改成功!');
                swal("修改成功!", "", "success")
            } else {
                //alert('修改失敗!');
                sweetAlert("修改失敗!", "", "error");
            }
            $('#maindiv').jqLoading("destroy");
        };
        options.error = function () {
            //alert('修改失敗!');
            sweetAlert("修改失敗!", "", "error");
            $('#maindiv').jqLoading("destroy");
        };
        $.ajax(options);
    }

    //證件資料-----------------------
    function Credentials() {
        var apiURL = "/ConInfo/GetCredentialsByID/";
        $("#theTableConCredentials").bootstrapTable('destroy');
        $("#theTableConCredentials").bootstrapTable({
            columns: [
                {
                    field: 'name',
                    title: '證件',
                    formatter: function (value, row, index) {
                        switch (value) {
                            case 'IDCardPos':
                                value = '護照正面';
                                break;
                            case 'IDCardBack':
                                value = '護照反面';
                                break;
                            case 'ResidenceProof':
                                value = '居住證明';
                                break;
                            case 'Consent':
                                value = '報聘表';
                                break;
                            default:
                                value = '';
                                break;
                        }
                        return value
                    },
                    halign: 'center',
                    align: 'center',
                    visible: true
                },
                {
                    field: 'IsHave',
                    title: '缺件狀態',
                    formatter: function (value, row, index) {
                        if (value == "True")
                            value = "V";
                        else
                            value = "X";
                        return value
                    },
                    halign: 'center',
                    align: 'center',
                    visible: true
                }
            ],
            classes: 'table table-striped table-hover ',
            url: apiURL,
            method: "Get",
            queryParams: { ConID: conAccount },
            dataType: "json",
            contentType: 'application/json,charset=utf-8',
            toolbar: "#toolbar",
            uniqueId: 'ID',
            //sortName:'id',
            //height: 520,
            pagination: true,
            ajaxOptions: "ajaxOptions",
            inlineEditing: true,
            virtualScroll: true,
            height: "auto",

            clickToSelect: true,
            singleSelect: true,
            onPageChange: function (currentPage, pageSize) {
                console.log("目前頁數:" + currentPage + ",一頁顯示:" + pageSize + "筆");
            },
            pageSize: 10,
            pageList: [10, 20, 50, 100],
            onLoadSuccess: function (data) {
                $('#myModalForConCredentials').modal('show');
            },
            onLoadError: function (res) {
            },
            formatRecordsPerPage: function (pageSize) {
                //return '&nbsp;&nbsp;每頁顯示' + pageSize + '筆';
            },
            formatShowingRows: function (fromIndex, toIndex, totalSize) {
                var currentPage = Math.ceil(fromIndex / this.pageSize);
                var totalPageCount = Math.ceil(totalSize / this.pageSize);
                //return '第' + currentPage + '頁&nbsp;&nbsp;共' + totalPageCount + '頁' + '總共' + totalSize + '筆資料';
            }
        });
    }
</script>